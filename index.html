<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حاسبة دجاج التسمين – النسخة النهائية</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
  body {
    font-family: 'Tajawal', sans-serif;
    background: url('https://i.imgur.com/7Z8jK9L.jpg') center/cover no-repeat;
    background-color: #FFF8E1;
    background-blend-mode: lighten;
  }
  .fade-in {
    animation: fadeInScale 0.6s ease forwards;
    opacity: 0;
  }
  @keyframes fadeInScale {
    0% { opacity: 0; transform: scale(0.95); }
    100% { opacity: 1; transform: scale(1); }
  }
</style>
</head>

<body class="text-gray-800 min-h-screen">

<header class="bg-gradient-to-r from-green-600 to-emerald-600 text-white text-center py-6 shadow-lg">
  <h1 class="text-3xl md:text-4xl font-extrabold flex justify-center items-center gap-2">
    <i class="fa-solid fa-drumstick-bite"></i>
    حاسبة دجاج التسمين – Poule de Chair Calculator
  </h1>
  <p class="mt-1 md:mt-2 font-semibold text-lg">
    النسخة النهائية الواقعية – السوق الجزائري 2025–2026 | Version réaliste – Marché algérien 2025–2026
  </p>
</header>

<div id="app" class="max-w-5xl mx-auto p-4 py-10">

  <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">

    <!-- Inputs -->
    <div class="grid sm:grid-cols-2 md:grid-cols-2 gap-5 p-8 bg-gray-50">

      <template v-for="(label,key) in labels" :key="key">
        <label class="block text-sm font-bold mb-1 flex items-center gap-1">
          <i :class="icons[key]"></i> {{ label.ar }} | {{ label.fr }}
        </label>
        <input type="number" v-model.number="form[key]"
          class="w-full border rounded-2xl px-4 py-3 focus:ring-2 focus:ring-amber-400 outline-none transition"
          min="0" step="any"
        />
      </template>

    </div>

    <!-- Buttons -->
    <div class="p-6 border-t flex flex-col sm:flex-row gap-4">
      <button @click="calculate"
        class="flex-1 bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 rounded-2xl shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-105">
        <i class="fa-solid fa-calculator"></i> احسب النتائج | Calculer
      </button>
      <button @click="resetForm"
        class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 rounded-2xl shadow-lg flex items-center justify-center gap-2 transition transform hover:scale-105">
        <i class="fa-solid fa-arrows-rotate"></i> إعادة التعيين | Réinitialiser
      </button>
    </div>

    <!-- Error -->
    <div v-if="error" class="p-4 text-center text-red-600 font-bold">
      {{ error }}
    </div>

    <!-- Results -->
    <div v-if="result" class="space-y-6 mt-4">

      <!-- الربح/الخسارة -->
      <div :class="result.profit>=0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
        class="fade-in rounded-2xl p-6 text-center font-extrabold text-2xl md:text-3xl shadow-inner">
        <div class="flex justify-center items-center gap-3 text-3xl mb-2">
          <i :class="result.profit>=0 ? 'fa-solid fa-face-smile' : 'fa-solid fa-face-frown'"></i>
          {{ result.profit>=0 ? 'الربح الصافي الحقيقي | Profit net réel' : 'الخسارة الصافية الحقيقية | Perte nette réelle' }}
        </div>
        <div class="text-4xl md:text-5xl font-black">
          {{ formatMoney(result.profit) }}
        </div>
      </div>

      <!-- التفاصيل -->
      <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-5 text-center">

        <div class="fade-in border rounded-2xl p-4 bg-yellow-50 shadow">
          <p class="text-sm text-gray-500">إجمالي الإيرادات | Revenus Totals</p>
          <p class="text-xl font-bold text-green-700"><i class="fa-solid fa-money-bill-wave"></i> {{ formatMoney(result.income) }}</p>
        </div>

        <div class="fade-in border rounded-2xl p-4 bg-red-50 shadow">
          <p class="text-sm text-gray-500">إجمالي التكاليف | Coûts Totals</p>
          <p class="text-xl font-bold text-red-600"><i class="fa-solid fa-wallet"></i> {{ formatMoney(result.totalCosts) }}</p>
        </div>

        <div class="fade-in border rounded-2xl p-4 bg-orange-50 shadow">
          <p class="text-sm text-gray-500">خسارة الدجاج الميت + غير المباع | Perte Poules mortes + invendus</p>
          <p class="text-xl font-bold text-orange-600"><i class="fa-solid fa-basket-shopping"></i> {{ formatMoney(result.lossDead) }}</p>
          <p class="text-xs text-gray-500 mt-1">خسارة تقريبية: مبكر20%، متوسط50%، متأخر85% | Perte approximative: tôt20%, moyen50%, tard85%</p>
        </div>

        <div class="fade-in border rounded-2xl p-4 bg-gray-50 shadow">
          <p class="text-sm text-gray-500">نسبة الدجاج الميت | % Poules mortes</p>
          <p class="text-xl font-bold"><i class="fa-solid fa-percent"></i> {{ result.mortality }}%</p>
        </div>

        <div class="fade-in border rounded-2xl p-4 bg-green-50 shadow">
          <p class="text-sm text-gray-500">متوسط وزن المباع | Poids moyen vendu</p>
          <p class="text-xl font-bold"><i class="fa-solid fa-weight-scale"></i> {{ result.avgWeight }} كغ</p>
        </div>

        <div class="fade-in border rounded-2xl p-4 bg-blue-50 shadow">
          <p class="text-sm text-gray-500">معامل التحويل FCR | Taux de conversion FCR</p>
          <p class="text-xl font-bold" :class="result.fcr<=1.8 ? 'text-green-600' : result.fcr<=2.1 ? 'text-orange-500' : 'text-red-600'">
            {{ result.fcr }}
          </p>
        </div>

        <div v-if="result.avgUnsoldValue" class="fade-in border rounded-2xl p-4 bg-lime-50 shadow">
          <p class="text-sm text-gray-500">قيمة الغير مباع المحتملة | Valeur possible invendus</p>
          <p class="text-xl font-bold text-green-700"><i class="fa-solid fa-lightbulb"></i> {{ formatMoney(result.avgUnsoldValue) }} (≈70%)</p>
        </div>

      </div>

    </div>

  </div>

  <footer class="text-center text-sm text-gray-500 mt-10">
    تطوير: <b class="text-green-700">Kaci Mebarek</b>
  </footer>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script>
const { createApp, ref } = Vue;

createApp({
setup(){
  const form = ref({
    priceChick:0,numChicks:0,feedPrice:0,feedUsed:0,sellPrice:0,commission:0,
    medicine:0,energy:0,bedding:0,cleaning:0,
    deadEarly:0,deadMid:0,deadLate:0,unsold:0,totalWeight:0
  });

  const labels = {
    priceChick:{ar:'سعر الكتكوت (دج)', fr:'Prix poussin (DZD)'},
    numChicks:{ar:'عدد الكتاكيت', fr:'Nombre de poussins'},
    feedPrice:{ar:'سعر القنطار علف (دج)', fr:'Prix quintal feed (DZD)'},
    feedUsed:{ar:'كمية العلف (قنطار)', fr:'Quantité feed (quintal)'},
    sellPrice:{ar:'سعر بيع الكيلو (دج)', fr:'Prix vente kg (DZD)'},
    commission:{ar:'عمولة الكيلو (دج)', fr:'Commission/kg (DZD)'},
    medicine:{ar:'الدواء (دج)', fr:'Médicaments (DZD)'},
    energy:{ar:'ماء + كهرباء + غاز (دج)', fr:'Eau + Electricité + Gaz (DZD)'},
    bedding:{ar:'الفرشة (دج)', fr:'Litière (DZD)'},
    cleaning:{ar:'التنظيف (دج)', fr:'Nettoyage (DZD)'},
    deadEarly:{ar:'الدجاج الميت المبكر (0–14 يوم)', fr:'Poules mortes tôt (0–14j)'},
    deadMid:{ar:'الدجاج الميت المتوسط (15–28 يوم)', fr:'Poules mortes moyen (15–28j)'},
    deadLate:{ar:'الدجاج الميت المتأخر (29+ يوم)', fr:'Poules mortes tard (29+j)'},
    unsold:{ar:'غير المباع', fr:'Invendus'},
    totalWeight:{ar:'الوزن المباع (كغ)', fr:'Poids vendu (kg)'}
  };

  const icons = {
    priceChick:'fa-solid fa-egg', numChicks:'fa-solid fa-chicken', feedPrice:'fa-solid fa-bag-shopping',
    feedUsed:'fa-solid fa-seedling', sellPrice:'fa-solid fa-hand-holding-dollar', commission:'fa-solid fa-coins',
    medicine:'fa-solid fa-syringe', energy:'fa-solid fa-droplet', bedding:'fa-solid fa-couch',
    cleaning:'fa-solid fa-broom', deadEarly:'fa-solid fa-skull-crossbones', deadMid:'fa-solid fa-skull-crossbones',
    deadLate:'fa-solid fa-skull-crossbones', unsold:'fa-solid fa-box', totalWeight:'fa-solid fa-weight-scale'
  };

  const result = ref(null);
  const error = ref(null);

  function calculate(){
    error.value = null;
    const totalDead = form.value.deadEarly+form.value.deadMid+form.value.deadLate;
    const total = form.value.numChicks;
    const sold = total - totalDead - form.value.unsold;

    if(total<=0 || sold<=0 || form.value.totalWeight<=0){
      error.value = 'تحقق من الحقول الأساسية | Vérifiez les champs essentiels';
      return;
    }

    const feedPerBird = form.value.feedUsed/total; // قنطار لكل دجاجة
    const feedRatio = { early:0.2, mid:0.5, late:0.85 };

    const feedLossDead =
      form.value.deadEarly*feedPerBird*feedRatio.early*form.value.feedPrice +
      form.value.deadMid*feedPerBird*feedRatio.mid*form.value.feedPrice +
      form.value.deadLate*feedPerBird*feedRatio.late*form.value.feedPrice;

    const chickLossDead = totalDead*form.value.priceChick;

    // غير المباع
    const feedLossUnsold = form.value.unsold*feedPerBird*feedRatio.late*form.value.feedPrice;
    const chickLossUnsold = form.value.unsold*form.value.priceChick*0.5; // خسارة فرصة
    const avgUnsoldValue = (form.value.unsold*form.value.sellPrice*0.7); // 70% فرصة بيع لاحق

    const totalCosts =
      form.value.priceChick*total +
      form.value.feedPrice*form.value.feedUsed +
      form.value.commission*form.value.totalWeight +
      form.value.medicine+form.value.energy+form.value.bedding+form.value.cleaning;

    const income = form.value.totalWeight*form.value.sellPrice;
    const lossDead = feedLossDead + chickLossDead + feedLossUnsold + chickLossUnsold;

    const profit = income - totalCosts - lossDead;

    const avgWeight = (form.value.totalWeight/sold).toFixed(3);
    const feedKg = form.value.feedUsed*100; // قنطار → كغ
    const fcr = (feedKg/form.value.totalWeight).toFixed(2);

    result.value = {
      profit,income,totalCosts,lossDead,
      mortality:((totalDead+form.value.unsold)/total*100).toFixed(2),
      avgWeight,fcr,avgUnsoldValue
    };
  }

  function formatMoney(v){
    if(v==null||isNaN(v)) return '—';
    return Math.abs(Math.round(v)).toLocaleString('fr-DZ')+' دج';
  }

  function resetForm(){
    Object.keys(form.value).forEach(k=>form.value[k]=0);
    result.value=null;
    error.value=null;
  }

  return { form, labels, icons, calculate, result, error, formatMoney, resetForm };
}
}).mount('#app');
</script>

</body>
</html>
