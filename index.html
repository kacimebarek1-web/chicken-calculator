<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حاسبة دجاج التسمين الواقعية 2026</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen font-sans">

<header class="bg-green-700 text-white text-center py-6 shadow-lg">
  <h1 class="text-3xl font-extrabold">
    <i class="fa-solid fa-drumstick-bite ml-2"></i>
    حاسبة دجاج التسمين الواقعية
  </h1>
  <p class="mt-2 font-semibold">
    حساب واقعي للسوق الجزائري 2025–2026
  </p>
</header>

<div id="app" class="max-w-5xl mx-auto p-4 py-10">

<div class="bg-white rounded-xl shadow-xl overflow-hidden">

<!-- Inputs -->
<div class="grid md:grid-cols-2 gap-4 p-6 bg-gray-50">
<div v-for="(label,key) in labels" :key="key">
  <label class="block text-sm font-bold mb-1">{{ label }}</label>
  <input type="number" v-model.number="form[key]"
         class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 outline-none">
</div>
</div>

<!-- Buttons -->
<div class="p-6 border-t flex flex-col sm:flex-row gap-3">
  <button @click="calculate"
          class="flex-1 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition-all flex items-center justify-center gap-2">
    <i class="fa-solid fa-calculator"></i> احسب النتائج
  </button>
  <button @click="resetForm"
          class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-bold hover:bg-gray-700 transition-all flex items-center justify-center gap-2">
    <i class="fa-solid fa-arrows-rotate"></i> إعادة تعيين
  </button>
</div>

<!-- Error -->
<div v-if="error" class="p-4 text-center text-red-600 font-bold">
  {{ error }}
</div>

<!-- Results -->
<div v-if="result" class="p-6 border-t space-y-5">

  <!-- Final Profit -->
  <div :class="result.profit>=0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
       class="rounded-xl p-6 text-center font-extrabold">
    <div class="text-xl mb-2">
      {{ result.profit>=0 ? 'الربح الصافي الحقيقي' : 'الخسارة الصافية الحقيقية' }}
    </div>
    <div class="text-4xl">{{ formatMoney(result.profit) }}</div>
  </div>

  <!-- Detailed Info -->
  <div class="grid md:grid-cols-3 gap-4 text-center">

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">إجمالي الإيرادات</p>
      <p class="text-xl font-bold text-green-700">{{ formatMoney(result.income) }}</p>
    </div>

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">إجمالي التكاليف</p>
      <p class="text-xl font-bold text-red-600">{{ formatMoney(result.totalCosts) }}</p>
    </div>

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">خسارة النافق المبكر</p>
      <p class="text-xl font-bold text-orange-500">{{ formatMoney(result.lossEarly) }}</p>
    </div>

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">خسارة النافق المتوسط</p>
      <p class="text-xl font-bold text-orange-500">{{ formatMoney(result.lossMid) }}</p>
    </div>

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">خسارة النافق المتأخر</p>
      <p class="text-xl font-bold text-orange-500">{{ formatMoney(result.lossLate) }}</p>
    </div>

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">خسارة الدجاج غير المباع</p>
      <p class="text-xl font-bold text-green-600">
        {{ formatMoney(result.lossUnsold) }}
        <span class="text-sm text-gray-500 block">متوسط وزن غير المباع (تقريبي): {{ result.avgWeightUnsold }} كغ</span>
        <span class="text-xs text-gray-500 block">إذا بيع لاحقًا ≈ 70% من قيمته</span>
      </p>
    </div>

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">نسبة النفوق الكلي</p>
      <p class="text-xl font-bold">{{ result.mortality }}%</p>
    </div>

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">متوسط وزن الدجاجة المباع</p>
      <p class="text-xl font-bold">{{ result.avgWeight }} كغ</p>
    </div>

    <div class="border rounded-lg p-4">
      <p class="text-sm text-gray-500">معامل التحويل FCR</p>
      <p class="text-xl font-bold"
         :class="result.fcr<=1.8 ? 'text-green-600' : result.fcr<=2.1 ? 'text-orange-500' : 'text-red-600'">
        {{ result.fcr }}
      </p>
    </div>

  </div>

  <div class="mt-4 text-sm text-gray-500 text-center">
    * نسب خسارة العلف التقريبية: مبكر 20%، متوسط 50%، متأخر 85% من حصة كل دجاجة.<br>
    * الخسارة للغير مباع = فرصة محتملة ≈ 70% من السعر الأصلي
  </div>

</div>

</div>

<footer class="text-center text-sm text-gray-500 mt-10">
  تطوير: <b class="text-green-700">Kaci Mebarek</b>
</footer>

</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script>
const { createApp, ref } = Vue;

createApp({
setup(){

// load saved data
const saved = JSON.parse(localStorage.getItem('broilerCalc') || '{}');

const form = ref({
  priceChick: saved.priceChick || 0,
  numChicks: saved.numChicks || 0,
  feedPrice: saved.feedPrice || 0,
  feedUsed: saved.feedUsed || 0,
  sellPrice: saved.sellPrice || 0,
  commission: saved.commission || 0,
  medicine: saved.medicine || 0,
  energy: saved.energy || 0,
  bedding: saved.bedding || 0,
  cleaning: saved.cleaning || 0,
  earlyDead: saved.earlyDead || 0,
  midDead: saved.midDead || 0,
  lateDead: saved.lateDead || 0,
  unsold: saved.unsold || 0,
  totalWeight: saved.totalWeight || 0
});

const labels = {
  priceChick:'سعر الكتكوت (دج)',
  numChicks:'عدد الكتاكيت',
  feedPrice:'سعر القنطار علف (دج)',
  feedUsed:'كمية العلف (قنطار)',
  sellPrice:'سعر بيع الكيلو (دج)',
  commission:'عمولة الكيلو (دج)',
  medicine:'الدواء (دج)',
  energy:'ماء + كهرباء (دج)',
  bedding:'الفرشة (دج)',
  cleaning:'التنظيف (دج)',
  earlyDead:'النافق المبكر (0–14 يوم)',
  midDead:'النافق المتوسط (15–28 يوم)',
  lateDead:'النافق المتأخر (29+ يوم)',
  unsold:'الدجاج غير المباع',
  totalWeight:'الوزن المباع (كغ)'
};

const result = ref(null);
const error = ref(null);

function saveData() {
  localStorage.setItem('broilerCalc', JSON.stringify(form.value));
}

function resetForm(){
  Object.keys(form.value).forEach(k => form.value[k]=0);
  result.value=null;
  saveData();
}

function calculate(){
  error.value = null;

  const totalDead = form.value.earlyDead + form.value.midDead + form.value.lateDead;
  const totalChicks = form.value.numChicks;
  const totalUnsold = form.value.unsold;
  const sold = totalChicks - totalDead - totalUnsold;

  if(totalChicks <=0 || form.value.totalWeight <=0){
    error.value = 'تحقق من عدد الكتاكيت والوزن المباع';
    return;
  }
  if(sold <=0){
    error.value = 'لا يوجد دجاج مباع';
    return;
  }

  const income = form.value.totalWeight * form.value.sellPrice;
  const totalCosts =
    (form.value.priceChick * totalChicks) +
    (form.value.feedPrice * form.value.feedUsed) +
    (form.value.commission * form.value.totalWeight) +
    form.value.medicine +
    form.value.energy +
    form.value.bedding +
    form.value.cleaning;

  const feedPerBird = form.value.feedUsed / totalChicks;

  const feedRatio = { early:0.2, mid:0.5, late:0.85 };

  const lossEarly = form.value.earlyDead * feedPerBird * feedRatio.early * form.value.feedPrice;
  const lossMid = form.value.midDead * feedPerBird * feedRatio.mid * form.value.feedPrice;
  const lossLate = form.value.lateDead * feedPerBird * feedRatio.late * form.value.feedPrice;

  const chickLoss = totalDead * form.value.priceChick;

  const lossUnsold = totalUnsold * (feedPerBird * feedRatio.late * form.value.feedPrice + form.value.priceChick * 0.5);
  const avgWeightUnsold = (form.value.totalWeight / sold).toFixed(2);

  const totalLossDead = lossEarly + lossMid + lossLate + chickLoss;
  const profit = income - totalCosts - totalLossDead - lossUnsold;

  const avgWeight = (form.value.totalWeight / sold).toFixed(2);
  const feedKg = form.value.feedUsed * 100;
  const fcr = (feedKg / form.value.totalWeight).toFixed(2);

  result.value = {
    profit,
    income,
    totalCosts,
    lossEarly,
    lossMid,
    lossLate,
    lossUnsold,
    avgWeightUnsold,
    mortality: ((totalDead + totalUnsold)/totalChicks*100).toFixed(2),
    avgWeight,
    fcr
  };

  saveData();
}

return { form, labels, result, error, calculate, resetForm, formatMoney(v){ return v!=null? Math.round(v).toLocaleString('fr-DZ')+' دج':'—'; } };
}
}).mount('#app');
</script>

</body>
</html>
