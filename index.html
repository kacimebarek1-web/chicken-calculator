<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ⴰⵙⴰⴳⵉ ⵏ ⵢⴰⵎⴰⵣⵉⵖ – حاسبة تسمين الدجاج</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#c62828',
            accent:  '#f59e0b',
            success: '#16a34a',
            danger:  '#dc2626',
            muted:   '#6b7280',
          }
        }
      }
    }
  </script>
</head>

<body class="min-h-screen bg-gradient-to-br from-amber-50 via-white to-amber-50 text-gray-800 antialiased">

  <!-- Header -->
  <header class="bg-gradient-to-r from-red-700 via-amber-600 to-blue-700 text-white py-8 shadow-xl">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">
        ⴰⵙⴰⴳⵉ ⵏ ⵢⴰⵎⴰⵣⵉⵖ
      </h1>
      <p class="text-xl md:text-2xl mt-2 font-semibold">حاسبة اقتصادية دجاج التسمين</p>
    </div>
  </header>

  <div id="app" class="container mx-auto px-4 py-10 max-w-4xl">

    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-100">

      <!-- Form Section -->
      <div class="p-6 md:p-8 grid md:grid-cols-2 gap-5 bg-gray-50">
        <div v-for="(field, key) in fields" :key="key" class="space-y-1.5">
          <label :for="key" class="block text-sm font-medium text-gray-700">
            {{ field.label }}
          </label>
          <input
            :id="key"
            v-model.number="form[key]"
            :type="field.type || 'number'"
            :placeholder="field.placeholder"
            step="any"
            min="0"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-accent focus:ring-2 focus:ring-accent/30 outline-none transition-all bg-white shadow-sm"
            @input="clearResultIfNeeded"
          />
        </div>
      </div>

      <!-- Buttons -->
      <div class="p-6 md:p-8 bg-white border-t border-gray-100 flex flex-col sm:flex-row gap-4">
        <button
          @click="calculate"
          class="flex-1 py-4 px-6 bg-primary hover:bg-red-700 text-white font-bold rounded-xl shadow-lg transition-all transform hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2 text-lg"
        >
          <i class="fa-solid fa-calculator"></i> احسب الربح / الخسارة
        </button>
        
        <button
          @click="resetForm"
          class="flex-1 py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-xl shadow-lg transition-all transform hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2 text-lg"
        >
          <i class="fa-solid fa-arrows-rotate"></i> إعادة تعبئة
        </button>
      </div>

      <!-- Result -->
      <div v-if="result !== null" class="p-6 md:p-8 border-t border-gray-100 bg-gradient-to-br from-gray-50 to-white">
        <div :class="[
          'p-6 rounded-2xl text-center text-2xl md:text-3xl font-bold shadow-inner',
          result.profit >= 0 ? 'bg-green-100 text-success' : 'bg-red-100 text-danger'
        ]">
          <div class="flex items-center justify-center gap-3 mb-3">
            <i :class="result.profit >= 0 ? 'fa-solid fa-face-smile' : 'fa-solid fa-face-frown'"></i>
            {{ result.profit >= 0 ? 'الربح المتوقع' : 'الخسارة المتوقعة' }}
          </div>
          <div class="text-4xl md:text-5xl">
            {{ formatMoney(Math.abs(result.profit)) }} دج
          </div>
        </div>

        <div class="mt-8 grid md:grid-cols-3 gap-5 text-center">
          <div class="bg-white p-5 rounded-xl shadow-sm border">
            <p class="text-muted text-sm mb-1">متوسط الوزن للدجاجة</p>
            <p class="text-2xl font-bold">{{ result.avgWeight }} كغ</p>
          </div>
          <div class="bg-white p-5 rounded-xl shadow-sm border">
            <p class="text-muted text-sm mb-1">نسبة النفوق + غير المباع</p>
            <p class="text-2xl font-bold text-danger">{{ result.mortality }}%</p>
          </div>
          <div class="bg-white p-5 rounded-xl shadow-sm border">
            <p class="text-muted text-sm mb-1">عدد الدجاج المباع فعليًا</p>
            <p class="text-2xl font-bold">{{ result.soldChicks }}</p>
          </div>
        </div>

        <div class="mt-8 text-sm text-muted text-center">
          * الحساب يفترض أن totalWeight هو وزن الدجاج المباع فقط
        </div>
      </div>

    </div>

    <!-- Footer -->
    <footer class="mt-12 text-center text-sm text-gray-500">
      <p>طورت بواسطة <span class="font-semibold text-primary">Kaci Mebarek</span> • 2025</p>
      <p class="mt-1">مفتوح المصدر على GitHub – مرحب بالمساهمات!</p>
    </footer>

  </div>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    const { createApp, ref, computed } = Vue;

    createApp({
      setup() {
        const form = ref({
          priceChick: null,
          numChicks: null,
          feedPrice: null,
          feedUsed: null,
          sellPrice: null,
          commission: null,
          medicine: null,
          energy: null,
          bedding: null,
          cleaning: null,
          deadTotal: 0,
          unsold: 0,
          totalWeight: null,   // وزن المباع فقط – مهم!
        });

        const fields = {
          priceChick: { label: 'سعر الكتكوت الواحد (دج)', placeholder: 'مثال: 85' },
          numChicks:  { label: 'عدد الكتاكيت المشتراة', placeholder: 'مثال: 5000' },
          feedPrice:  { label: 'سعر القنطار علف (دج)', placeholder: 'مثال: 7500' },
          feedUsed:   { label: 'كمية العلف المستعمل (قنطار)', placeholder: 'مثال: 120' },
          sellPrice:  { label: 'سعر بيع الكيلو الحي (دج)', placeholder: 'مثال: 480' },
          commission: { label: 'عمولة التاجر للكيلو (دج)', placeholder: 'مثال: 15' },
          medicine:   { label: 'إجمالي الدواء واللقاحات (دج)', placeholder: '0 إذا لا يوجد' },
          energy:     { label: 'ماء + كهرباء + غاز (دج)', placeholder: '0 إذا لا يوجد' },
          bedding:    { label: 'تكلفة الفرشة (دج)', placeholder: '0 إذا لا يوجد' },
          cleaning:   { label: 'تكلفة التنظيف والتعقيم (دج)', placeholder: '0 إذا لا يوجد' },
          deadTotal:  { label: 'عدد الدجاج النافق', placeholder: '0 إذا لا يوجد' },
          unsold:     { label: 'عدد الدجاج غير المباع', placeholder: '0 إذا كله مباع' },
          totalWeight:{ label: 'الوزن الكلي المباع (كغ)', placeholder: 'مثال: 8750' },
        };

        const result = ref(null);

        const calculate = () => {
          // التحقق الأساسي
          if (!form.value.numChicks || !form.value.totalWeight || form.value.numChicks <= 0 || form.value.totalWeight <= 0) {
            alert('يرجى ملء عدد الكتاكيت والوزن المباع بشكل صحيح');
            return;
          }

          const totalChicks = form.value.numChicks;
          const dead = form.value.deadTotal || 0;
          const unsold = form.value.unsold || 0;
          const soldChicks = totalChicks - dead - unsold;

          const costs =
            (form.value.priceChick || 0) * totalChicks +
            (form.value.feedPrice || 0) * (form.value.feedUsed || 0) +
            (form.value.medicine || 0) +
            (form.value.energy || 0) +
            (form.value.bedding || 0) +
            (form.value.cleaning || 0) +
            (form.value.commission || 0) * (form.value.totalWeight || 0);

          const income = (form.value.totalWeight || 0) * (form.value.sellPrice || 0);

          const lostChicksCost = (dead + unsold) * (form.value.priceChick || 0);

          const profit = income - costs - lostChicksCost;

          result.value = {
            profit,
            avgWeight: soldChicks > 0 ? (form.value.totalWeight / soldChicks).toFixed(3) : '—',
            mortality: ((dead + unsold) / totalChicks * 100).toFixed(2),
            soldChicks,
          };
        };

        const formatMoney = (value) => {
          if (!value && value !== 0) return '—';
          if (value >= 1_000_000) return (value / 1_000_000).toFixed(2) + ' مليون';
          if (value >= 10_000)    return Math.round(value / 1_000) + ' ألف';
          return Math.round(value).toLocaleString('ar-DZ');
        };

        const resetForm = () => {
          Object.keys(form.value).forEach(key => {
            form.value[key] = key === 'deadTotal' || key === 'unsold' ? 0 : null;
          });
          result.value = null;
        };

        const clearResultIfNeeded = () => {
          if (result.value) result.value = null;
        };

        return {
          form,
          fields,
          result,
          calculate,
          formatMoney,
          resetForm,
          clearResultIfNeeded,
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
