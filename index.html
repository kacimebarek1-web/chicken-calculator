<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ⴰⵙⴰⴳⵉ ⵏ ⵢⴰⵎⴰⵣⵉⵖ – حاسبة تسمين دجاج محترفة</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { primary: '#c62828', accent: '#f59e0b', success: '#16a34a', danger: '#dc2626', muted: '#6b7280' } } }
    }
  </script>
</head>

<body class="min-h-screen bg-gradient-to-br from-amber-50 via-white to-amber-50 text-gray-800 antialiased">

  <header class="bg-gradient-to-r from-red-700 via-amber-600 to-blue-700 text-white py-8 shadow-xl">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl md:text-4xl font-extrabold">ⴰⵙⴰⴳⵉ ⵏ ⵢⴰⵎⴰⵣⵉⵖ</h1>
      <p class="text-xl md:text-2xl mt-2 font-semibold">حاسبة اقتصادية دجاج التسمين – نسخة محترفة</p>
    </div>
  </header>

  <div id="app" class="container mx-auto px-4 py-10 max-w-4xl">

    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-100">

      <div class="p-6 md:p-8 grid md:grid-cols-2 gap-5 bg-gray-50">
        <div v-for="(field, key) in fields" :key="key" class="space-y-1.5">
          <label :for="key" class="block text-sm font-medium text-gray-700">
            {{ field.label }}
            <span v-if="field.required" class="text-red-600">*</span>
          </label>
          <input
            :id="key"
            v-model.number="form[key]"
            :type="field.type || 'number'"
            :placeholder="field.placeholder"
            :min="field.min || 0"
            step="any"
            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-accent focus:ring-2 focus:ring-accent/30 outline-none transition-all bg-white shadow-sm"
            @input="clearResult"
          />
        </div>
      </div>

      <div class="p-6 md:p-8 bg-white border-t border-gray-100 flex flex-col sm:flex-row gap-4">
        <button @click="calculate" class="flex-1 py-4 px-6 bg-primary hover:bg-red-800 text-white font-bold rounded-xl shadow-lg transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2 text-lg">
          <i class="fa-solid fa-calculator"></i> احسب الربح / الخسارة
        </button>
        <button @click="resetForm" class="flex-1 py-4 px-6 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-xl shadow-lg transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2 text-lg">
          <i class="fa-solid fa-arrows-rotate"></i> إعادة تعبئة
        </button>
      </div>

      <div v-if="result !== null" class="p-6 md:p-8 border-t border-gray-100 bg-gradient-to-br from-gray-50 to-white">
        <div :class="['p-6 rounded-2xl text-center text-2xl md:text-3xl font-bold shadow-inner', result.profit >= 0 ? 'bg-green-100 text-success' : 'bg-red-100 text-danger']">
          <div class="flex items-center justify-center gap-3 mb-3 text-3xl">
            <i :class="result.profit >= 0 ? 'fa-solid fa-face-smile' : 'fa-solid fa-face-frown'"></i>
            {{ result.profit >= 0 ? 'الربح المتوقع' : 'الخسارة المتوقعة' }}
          </div>
          <div class="text-4xl md:text-5xl font-black">
            {{ formatMoney(Math.abs(result.profit)) }}
          </div>
        </div>

        <div class="mt-8 grid md:grid-cols-2 lg:grid-cols-4 gap-5 text-center">
          <div class="bg-white p-5 rounded-xl shadow-sm border">
            <p class="text-muted text-sm mb-1">متوسط وزن المباع</p>
            <p class="text-2xl font-bold">{{ result.avgWeight }} كغ</p>
          </div>
          <div class="bg-white p-5 rounded-xl shadow-sm border">
            <p class="text-muted text-sm mb-1">نسبة النفوق + غير مباع</p>
            <p class="text-2xl font-bold text-danger">{{ result.mortality }}%</p>
          </div>
          <div class="bg-white p-5 rounded-xl shadow-sm border">
            <p class="text-muted text-sm mb-1">عدد المباع فعلياً</p>
            <p class="text-2xl font-bold">{{ result.soldChicks }}</p>
          </div>
          <div class="bg-white p-5 rounded-xl shadow-sm border">
            <p class="text-muted text-sm mb-1">خسارة علف النافق (تقريبي)</p>
            <p class="text-xl font-bold text-orange-600">{{ formatMoney(result.feedLossDead) }} دج</p>
          </div>
        </div>

        <div class="mt-6 text-sm text-muted text-center">
          * totalWeight = وزن المباع فقط • العمر التقريبي للنفوق يؤثر على تقدير خسارة العلف
        </div>
      </div>

    </div>

    <footer class="mt-12 text-center text-sm text-gray-500">
      <p>طورت بواسطة <span class="font-semibold text-primary">Kaci Mebarek</span> • 2025–2026</p>
      <p class="mt-1">مفتوح المصدر – GitHub</p>
    </footer>

  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    const { createApp, ref } = Vue;

    createApp({
      setup() {
        const form = ref({
          priceChick: null,     // سعر الكتكوت
          numChicks: null,      // عدد المشتراة
          feedPrice: null,      // سعر القنطار
          feedUsed: null,       // قنطار مستعمل
          sellPrice: null,      // سعر الكيلو مباع
          commission: null,     // عمولة / كغ
          medicine: 0,
          energy: 0,
          bedding: 0,
          cleaning: 0,
          deadTotal: 0,         // عدد النافق
          unsold: 0,            // غير مباع
          totalWeight: null,    // وزن مباع فقط (كغ)
          avgMortalityAge: 21   // متوسط عمر النفوق بالأيام (افتراضي)
        });

        const fields = {
          priceChick:     { label: 'سعر الكتكوت الواحد (دج)', placeholder: 'مثال: 85', required: true },
          numChicks:      { label: 'عدد الكتاكيت المشتراة', placeholder: 'مثال: 5000', required: true },
          feedPrice:      { label: 'سعر القنطار علف (دج)', placeholder: 'مثال: 7500', required: true },
          feedUsed:       { label: 'كمية العلف المستعمل (قنطار)', placeholder: 'مثال: 120', required: true },
          sellPrice:      { label: 'سعر بيع الكيلو الحي (دج)', placeholder: 'مثال: 480', required: true },
          commission:     { label: 'عمولة التاجر للكيلو (دج)', placeholder: 'مثال: 15 أو 0' },
          medicine:       { label: 'إجمالي الدواء واللقاحات (دج)' },
          energy:         { label: 'ماء + كهرباء + غاز (دج)' },
          bedding:        { label: 'تكلفة الفرشة (دج)' },
          cleaning:       { label: 'تكلفة التنظيف (دج)' },
          deadTotal:      { label: 'عدد الدجاج النافق', placeholder: '0 إذا لا يوجد' },
          unsold:         { label: 'عدد الدجاج غير المباع', placeholder: '0 إذا كله مباع' },
          totalWeight:    { label: 'الوزن الكلي المباع (كغ)', placeholder: 'مثال: 9200', required: true },
          avgMortalityAge:{ label: 'متوسط عمر النفوق (أيام)', placeholder: 'مثال: 21 – افتراضي 21' }
        };

        const result = ref(null);

        // جدول تقريبي لنسبة العلف المستهلك تراكمياً (مبني على Cobb/Ross + تجارب جزائرية شائعة)
        const getFeedConsumptionRatio = (age) => {
          if (age <= 7)  return 0.04;     // ~4%
          if (age <= 14) return 0.12;     // ~12%
          if (age <= 21) return 0.28;     // ~28%
          if (age <= 28) return 0.50;     // ~50%
          if (age <= 35) return 0.75;     // ~75%
          return 0.92;                    // قريب من النهاية ~92–95%
        };

        const calculate = () => {
          // التحقق الأساسي
          if (!form.value.numChicks || !form.value.totalWeight || form.value.numChicks <= 0 || form.value.totalWeight <= 0 ||
              !form.value.priceChick || !form.value.feedPrice || !form.value.sellPrice) {
            alert('يرجى ملء الحقول الأساسية: عدد الكتاكيت، الوزن المباع، أسعار الكتكوت/العلف/البيع');
            return;
          }

          const totalChicks = form.value.numChicks;
          const dead = form.value.deadTotal || 0;
          const unsoldChicks = form.value.unsold || 0;
          const sold = totalChicks - dead - unsoldChicks;

          // نسبة العلف المستهلك قبل الموت (لكل نافق)
          const mortalityAge = Math.max(1, Math.min(42, form.value.avgMortalityAge || 21));
          const feedRatioDead = getFeedConsumptionRatio(mortalityAge);

          // علف مهدور بسبب النافق (قنطار)
          const feedPerBirdTotal = form.value.feedUsed / totalChicks;
          const wastedFeedPerDead = feedPerBirdTotal * feedRatioDead;
          const totalWastedFeed = wastedFeedPerDead * dead;  // قنطار
          const feedLossValue = totalWastedFeed * form.value.feedPrice;  // دج

          // التكاليف
          const chickCost = form.value.priceChick * totalChicks;
          const feedCost = form.value.feedPrice * form.value.feedUsed;
          const commissionCost = (form.value.commission || 0) * form.value.totalWeight;
          const otherCosts = (form.value.medicine || 0) + (form.value.energy || 0) + (form.value.bedding || 0) + (form.value.cleaning || 0);

          const totalCosts = chickCost + feedCost + commissionCost + otherCosts;

          // الإيرادات
          const income = form.value.totalWeight * form.value.sellPrice;

          // خسارة الكتاكيت (سعر الشراء للميت + غير المباع)
          const lostChicksValue = (dead + unsoldChicks) * form.value.priceChick;

          // الربح النهائي
          const profit = income - totalCosts - lostChicksValue - feedLossValue;

          result.value = {
            profit,
            avgWeight: sold > 0 ? (form.value.totalWeight / sold).toFixed(3) : '—',
            mortality: ((dead + unsoldChicks) / totalChicks * 100).toFixed(2),
            soldChicks: sold,
            feedLossDead: Math.round(feedLossValue)
          };
        };

        const formatMoney = (value) => {
          if (value == null || isNaN(value)) return '—';
          const abs = Math.abs(value);
          const dinars = Math.floor(abs);
          const centimes = Math.round((abs - dinars) * 100);

          let main = '';
          if (dinars >= 1_000_000_000) main = (dinars / 1_000_000_000).toFixed(2) + ' مليار';
          else if (dinars >= 1_000_000) main = (dinars / 1_000_000).toFixed(2) + ' مليون';
          else if (dinars >= 1_000) main = Math.round(dinars / 1_000) + ' ألف';
          else main = dinars.toLocaleString('ar-DZ');

          let centsStr = '';
          if (centimes > 0) {
            if (centimes >= 100_000) centsStr = Math.round(centimes / 1_000) + ' ألف';
            else if (centimes >= 1_000) centsStr = (centimes / 1_000).toFixed(1) + ' ألف';
            else centsStr = centimes.toLocaleString('ar-DZ');
          }

          let str = main;
          if (centsStr) str += ` (${centsStr} سنتيم)`;

          return value < 0 ? '-' + str : str;
        };

        const resetForm = () => {
          Object.keys(form.value).forEach(k => {
            form.value[k] = ['deadTotal', 'unsold', 'medicine', 'energy', 'bedding', 'cleaning'].includes(k) ? 0 : null;
          });
          form.value.avgMortalityAge = 21;
          result.value = null;
        };

        const clearResult = () => { result.value = null; };

        return { form, fields, result, calculate, formatMoney, resetForm, clearResult };
      }
    }).mount('#app');
  </script>
</body>
</html>
